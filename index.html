// Карты Ленорман (36 карт, упрощенный список для примера)
const lenormandCards = [
    { name: "Всадник", number: 1, description: "Новости, движение, визиты." },
    { name: "Клевер", number: 2, description: "Удача, возможности, легкость." },
    { name: "Корабль", number: 3, description: "Путешествия, исследования, перемены." },
    // ... добавь остальные карты до 36
    { name: "Кольцо", number: 25, description: "Союзы, обязательства, циклы." },
    // Для примера сокращено, полный список можно дополнить
];

// Функция для суммы цифр числа
function sumDigits(number) {
    return number.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
}

// Функция для парсинга даты в формате ДД.ММ.ГГГГ
function parseDate(dateStr) {
    const [day, month, year] = dateStr.split('.').map(Number);
    if (!day || !month || !year || day > 31 || month > 12 || year < 1900 || year > 2100) {
        return null;
    }
    return { day, month, year };
}

// Основная функция расчета
function calculateLenormand() {
    const birthDateInput = document.getElementById('birthDate').value;
    const targetDateInput = document.getElementById('targetDate').value;
    const errorDiv = document.getElementById('error');
    const resultDiv = document.getElementById('result');
    const loader = document.getElementById('loader');

    errorDiv.textContent = '';
    resultDiv.innerHTML = '';
    loader.style.display = 'block';

    // Валидация дат
    const birthDate = parseDate(birthDateInput);
    const targetDate = parseDate(targetDateInput);

    if (!birthDate || !targetDate) {
        errorDiv.textContent = 'Пожалуйста, введите даты в формате ДД.ММ.ГГГГ';
        loader.style.display = 'none';
        return;
    }

    setTimeout(() => {
        // Сумма цифр даты рождения (П)
        const birthSum = sumDigits(birthDate.day) + sumDigits(birthDate.month) + sumDigits(birthDate.year);
        const P = sumDigits(birthSum);

        // Сумма цифр интересующей даты (Д)
        const targetSum = sumDigits(targetDate.day) + sumDigits(targetDate.month) + sumDigits(targetDate.year);
        const D = sumDigits(targetSum);

        // Формула: 2 * П + Д
        let cardNumber = 2 * P + D;

        // Приведение к диапазону 1–36
        while (cardNumber > 36) {
            cardNumber = sumDigits(cardNumber);
        }
        if (cardNumber === 0) cardNumber = 36; // На случай, если результат 0

        // Поиск карты
        const card = lenormandCards.find(c => c.number === cardNumber) || lenormandCards[0];

        // Вывод результата
        resultDiv.innerHTML = `
            <div class="card fade-in">
                <svg viewBox="0 0 24 24" fill="#f48fb1"><path d="M12 2L2 7v10l10 5 10-5V7L12 2z"/></svg>
                <h3>${card.name}</h3>
                <p>Номер: ${card.number}</p>
                <p>${card.description}</p>
            </div>
        `;

        loader.style.display = 'none';
    }, 1000); // Имитация загрузки
}

// Очистка формы
function clearForm() {
    document.getElementById('birthDate').value = '';
    document.getElementById('targetDate').value = '';
    document.getElementById('error').textContent = '';
    document.getElementById('result').innerHTML = '';
}

// Сохранение результатов (заглушка)
function saveResults() {
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modal-title');
    const modalText = document.getElementById('modal-text');
    modalTitle.textContent = 'Сохранение';
    modalText.textContent = 'Функция сохранения в разработке!';
    modal.style.display = 'flex';
}

// Закрытие модального окна
function closeModal() {
    document.getElementById('modal').style.display = 'none';
}

// Частицы для фона
function initParticles() {
    const canvas = document.getElementById('particles');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const particles = [];
    for (let i = 0; i < 100; i++) {
        particles.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            radius: Math.random() * 2 + 1,
            speed: Math.random() * 0.5 + 0.2,
            color: `rgba(244, 143, 177, ${Math.random() * 0.5 + 0.2})`
        });
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => {
            p.y += p.speed;
            if (p.y > canvas.height) p.y = 0;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
            ctx.fillStyle = p.color;
            ctx.fill();
        });
        requestAnimationFrame(animate);
    }
    animate();
}

// Инициализация
window.onload = initParticles;         
